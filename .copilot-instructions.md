# Copilot Instructions for Tommy

> **Project-specific context for AI assistants**

## Project Overview

- **Type:** Streamlit App
- **Category:** client-work
- **Tech Stack:** Streamlit, Python, Pandas, PostgreSQL (Supabase), Docker
- **Primary Language:** Python
- **Client:** Arbeitgeber
- **Purpose:** Monatsdaten-Verwaltung & Visualisierung

## Development Commands

**Start Dev Server (Local):**

```bash
cd ~/projects/client-work/Tommy/app
streamlit run app.py
# Dev server: http://localhost:8501
```

**With Docker:**

```bash
cd ~/projects/client-work/Tommy/app
docker-compose up
# Container-based deployment
```

**With USB (Docker Compose USB):**

```bash
cd ~/projects/client-work/Tommy/app
docker-compose -f docker-compose-usb.yml up
```

**Install Dependencies:**

```bash
cd ~/projects/client-work/Tommy/app
pip install -r requirements.txt
```

**Database Operations:**

```bash
# Dump database
python dump_database.py

# Migrate database
python migrate.py
```

**Deploy:**

```bash
cd ~/projects/client-work/Tommy
quick-deploy
# Or: git push (Streamlit Cloud auto-deploys)
# Or: Deploy to Synology (see SYNOLOGY_ANLEITUNG.md)
```

## Project Structure

```
Tommy/
├── app/
│   ├── app.py                    # Main Streamlit app
│   ├── auth.py                   # Authentication logic
│   ├── database.py               # Database operations
│   ├── migrate.py                # Database migrations
│   ├── dump_database.py          # Database backup
│   ├── requirements.txt          # Python dependencies
│   ├── Dockerfile                # Docker configuration
│   ├── docker-compose.yml        # Docker Compose config
│   ├── docker-compose-usb.yml    # USB variant
│   └── SYNOLOGY_ANLEITUNG.md     # Synology deployment guide
├── monatsdaten/                  # Monthly data files
├── .devcontainer/                # VS Code Dev Container
├── README.md                     # Project documentation
├── SUPABASE_SETUP.md             # Supabase setup guide
├── CHANGELOG.md                  # Version history
└── vercel.json                   # Vercel configuration
```

## Key Context

### What this project does:

Streamlit-basierte Applikation für Monatsdaten-Verwaltung mit:

- PostgreSQL/Supabase Backend
- Pandas für Datenverarbeitung
- Excel-Import/Export (openpyxl)
- Altair Visualisierungen
- Docker-Deployment
- Authentication System

### Important files:

- app/app.py - Main application (22KB)
- app/database.py - Database layer (12KB)
- app/auth.py - Authentication (3.9KB)
- requirements.txt - Python dependencies
- SUPABASE_SETUP.md - Database setup guide
- SYNOLOGY_ANLEITUNG.md - Synology deployment
- vercel.json - Vercel deployment config
- README.md - Project documentation (8.8KB)

### Environment Variables:

Supabase connection (check .env or Streamlit secrets):

- SUPABASE_URL
- SUPABASE_KEY
- Database credentials

### External Services:

- **Supabase** - PostgreSQL database hosting
- **Streamlit Cloud** - Deployment option
- **Vercel** - Alternative deployment
- **Synology** - Self-hosted deployment option

## Code Style & Conventions

- **Language:** Python 3.x
- **Style:** PEP 8
- **Database:** PostgreSQL (psycopg2-binary)
- **Data Processing:** Pandas DataFrames
- **Visualization:** Altair charts
- **Commit Style:** Conventional Commits (feat:, fix:, docs:, etc.)

## Common Tasks

### Add new feature:

1. Create feature branch: `git checkout -b feat/feature-name`
2. Implement in app.py or new module
3. Test locally: `streamlit run app/app.py`
4. Commit: `git commit -m "feat: description"`
5. Push: `git push origin feat/feature-name`

### Database operations:

```python
# In database.py or new script
from database import get_connection

conn = get_connection()
cursor = conn.cursor()
cursor.execute("SELECT * FROM table_name")
results = cursor.fetchall()
```

### Add new visualization:

```python
import altair as alt
import pandas as pd

chart = alt.Chart(df).mark_bar().encode(
    x='month',
    y='value'
)
st.altair_chart(chart)
```

### Backup database:

```bash
cd ~/projects/client-work/Tommy/app
python dump_database.py
```

### Migrate database:

```bash
cd ~/projects/client-work/Tommy/app
python migrate.py
```

### Deploy to Streamlit Cloud:

```bash
git push origin main
# Auto-deploys via Streamlit Cloud
```

### Deploy to Synology:

```bash
# Follow steps in app/SYNOLOGY_ANLEITUNG.md
docker-compose up -d
```

## Dependencies

**Core:**

- streamlit >= 1.28.0 - Web framework
- pandas >= 2.0.0 - Data processing
- altair >= 5.0.0 - Visualizations
- openpyxl >= 3.1.0 - Excel support
- psycopg2-binary >= 2.9.9 - PostgreSQL driver

## Supabase Setup

See `SUPABASE_SETUP.md` for detailed setup instructions:

1. Create Supabase project
2. Configure database schema
3. Get API keys
4. Configure Streamlit secrets

## Docker Deployment

**Standard:**

```bash
docker-compose up -d
```

**With USB access:**

```bash
docker-compose -f docker-compose-usb.yml up -d
```

## Authentication

Auth system in `auth.py`:

- User login/logout
- Session management
- Protected routes

## Troubleshooting

### Port 8501 in use:

```bash
kill -9 $(lsof -ti:8501)
streamlit run app/app.py
```

### Database connection issues:

- Check Supabase credentials in .env
- Verify database is running
- Check network connectivity

### Docker issues:

```bash
docker-compose down
docker-compose up --build
```

### Module import errors:

```bash
cd ~/projects/client-work/Tommy/app
pip install -r requirements.txt --upgrade
```

## Development with VS Code

Dev Container configuration available in `.devcontainer/`:

- Reopen in Container for isolated environment
- All dependencies pre-installed

## Deployment Options

1. **Streamlit Cloud** (Easiest)
   - Connect GitHub repo
   - Auto-deploys on push
   - Free tier available

2. **Vercel** (configured)
   - `vercel.json` present
   - Serverless deployment

3. **Synology NAS** (Self-hosted)
   - See `SYNOLOGY_ANLEITUNG.md`
   - Docker-based deployment

4. **Docker** (Any host)
   - Use docker-compose.yml
   - Portable deployment

## Notes

- **Monatsdaten** folder for monthly data files
- **PostgreSQL backend** via Supabase
- **Excel support** for import/export
- **Multiple deployment options** (Cloud & Self-hosted)
- **Dev Container** ready for VS Code
- **Authentication system** included
- **Database migration** tools available

---

**Created:** 2026-01-25
**User:** mokkini
**Client:** Arbeitgeber
**Framework:** Streamlit
**Database:** Supabase (PostgreSQL)
**Deployment:** Streamlit Cloud / Vercel / Synology
**Docs:** README.md, SUPABASE_SETUP.md, SYNOLOGY_ANLEITUNG.md
